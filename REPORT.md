#Final Report

**Jessie Stam** - *10560599*

Deze applicatie is een gedigitaliseerde versie van een duiklogboek. Als duiker wordt je getracht een logboek bij te houden van je gemaakte duiken. Hierin wordt onder andere bijgehouden waar je hebt gedoken, wanneer, met wie, hoeveel uur van je leven je in totaal onder water hebt doorgebracht, et cetera. Dit is niet enkel omdat het leuk is om later terug te lezen, maar vooral voor het garanderen van je veiligheid. Bij het loggen van een duik moet namelijk ook berekend worden hoeveel stikstof er na de duik in het bloed zit. Een teveel aan stikstof kan namelijk lijden tot decompressie- of caissonziekte, iets dat zeer gevaarlijk en zelfs dodelijk kan zijn. Het verraderlijke is dat des te hoger het stikstofpercentage in het bloed, des te moeilijk het voor de duiker is om helder na te denken en een goede berekening te maken. Dit probleem wordt met deze applicatie aangepakt. De duiker vult de gegevens in en de applicatie doet dan de berekening. Hierdoor wordt de foutgevoeligheid kleiner. Als het stikstofpercentage aan de hoge kant is, wordt de duiker gewaarschuwd.

<img src="https://github.com/JessieStam/jstam_programmeerproject/blob/master/doc/titelscherm.png" width="600">


Als de applicatie wordt geopend heeft de duiker de keuze om in te loggen of een nieuw account aan te maken. Zodra de duiker is ingelogd, komt hij in een menu terecht waar hij meerdere opties heeft. Hier kan hij kiezen of hij een nieuwe duik aanmaakt, het logboek bekijkt, zijn statistieken inziet of zijn stikstoflevels opnieuw berekent. Al deze keuzes leiden naar een nieuwe activity. Dit is hoe de applicatie grofweg in elkaar zit.

Als we wat gedetailleerder op de applicatie in gaan zit het natuurlijk iets complexer in elkaar. De eerste activity die wordt getoond bij het openen van de applicatie is de HomeActivity. Dit is het welkomscherm, waarop twee knoppen staan: één om in te loggen en één om te registeren. Beide knoppen leiden naar de LoginActivity, alleen geven ze verschillende parameters mee. Deze bepalen vervolgens de interface van de LoginActivity (zoals de titel en instructies) en of de duiker een gebruikersnaam een wachtwoord bevestiging moet opgeven (bij het registreren van een nieuw account). Na het creëren van een account wordt er een UserItem opgeslagen op Firebase. Er is gekozen voor een inlogfunctie omdat de duiker dan ook op andere apparaten zijn logboek kan bekijken en omdat verschillende duikers zo hetzelfde apparaat kunnen gebruiken. Pas wanneer er is ingelogd kan de duiker dieper de applicatie in.

<img src="https://github.com/JessieStam/jstam_programmeerproject/blob/master/doc/inlogscherm.png" width="250">
<img src="https://github.com/JessieStam/jstam_programmeerproject/blob/master/doc/registreerscherm.png" width="250">
<img src="https://github.com/JessieStam/jstam_programmeerproject/blob/master/doc/inlogsucces.png" width="250">


Na het inloggen komt de duiker in de MenuActivity, waar zoals gezegd vier knoppen zijn: een nieuwe duik maken, logboek bekijken, statistieken bekijken en stikstoflevels herberekenen. Ook is er vanaf deze activity overal in de applicatie een toolbar met dezelfde knoppen. Zo kan de duiker vanaf elk punt in de applicatie naar een andere activity zonder eerst terug te moeten naar het menu. Ook heeft de toolbar een uitlogfunctie. Als er wordt uitgelogd, wordt de duiker automatisch teruggebracht naar de HomeActivity. Zo kan een andere duiker meteen daarna ook inloggen en bijvoorbeeld een nieuwe duik toevoegen. De toolbar werkt door middel van de ToolbarHelper class.

<img src="https://github.com/JessieStam/jstam_programmeerproject/blob/master/doc/menuscherm.png" width="250">
<img src="https://github.com/JessieStam/jstam_programmeerproject/blob/master/doc/toolbar.png" width="250">

Als de duiker ervoor kiest een nieuwe duik aan te maken, wordt hij naar de NewDiveActivity geleid. Deze activity zit vrij complex in elkaar; in eerste instantie bevat deze geen zichtbare functies. Er wordt hier gebruik gemaakt van vijftien verschillende fragments: vijf “rootfragments” die alle vijf een container vormen voor twee “displayfragments”. Deze rootfragments staan in een tab layout en kunnen één voor één bekeken worden door over het scherm te swipen. Als de activity wordt geopend zijn de “unfinished” fragments te zien: dit zijn de fragments waar de duiker informatie over de duik kan invullen. Er is er één voor algemene informatie, omstandigheden, uitrusting, technische informatie en extra aantekeningen. Er is gekozen om deze informatie op te splitsen over meerdere fragments zodat het een overzichtelijker geheel is en de duiker niet steeds hoeft te scrollen. Zodra de duiker de informatie in één fragment heeft ingevuld kan hij onder in het fragment op de opslaan knop drukken. Hierdoor wordt, mits de data wordt goedgekeurd, het “unfinished” fragment vervangen door het “finished” fragment.

<img src="https://github.com/JessieStam/jstam_programmeerproject/blob/master/doc/nieuweduik1.png" width="250">
<img src="https://github.com/JessieStam/jstam_programmeerproject/blob/master/doc/nieuweduik2.png" width="250">
<img src="https://github.com/JessieStam/jstam_programmeerproject/blob/master/doc/nieuweduik3.png" width="250">
<img src="https://github.com/JessieStam/jstam_programmeerproject/blob/master/doc/nieuweduik4.png" width="250">
<img src="https://github.com/JessieStam/jstam_programmeerproject/blob/master/doc/nieuweduik5.png" width="250">

De “finished” fragments gebruiken een textdocument met placeholders om de door de duiker ingevulde data weer te geven. De TextDisplayManager class leest deze in en vervangt de placeholders door de juiste data. De informatie komt zo in een soort verslag te staan. Als de duiker iets wil wijzigen kan hij op de wijzig knop drukken en wordt het fragment weer vervangen door het “unfinished” fragment. Hij kan de data dan opnieuw invoeren. Als de duiker de terugknop indrukt tijdens het invullen van de gegevens, geeft de applicatie een waarschuwing dat de ingevulde data hierdoor verloren zal gaan. De duiker kan dan kiezen te blijven, of om terug te keren naar het menu.

<img src="https://github.com/JessieStam/jstam_programmeerproject/blob/master/doc/opgeslagen1.png" width="250">
<img src="https://github.com/JessieStam/jstam_programmeerproject/blob/master/doc/opgeslagen2.png" width="250">
<img src="https://github.com/JessieStam/jstam_programmeerproject/blob/master/doc/opgeslagen3.png" width="250">
<img src="https://github.com/JessieStam/jstam_programmeerproject/blob/master/doc/opgeslagen4.png" width="250">
<img src="https://github.com/JessieStam/jstam_programmeerproject/blob/master/doc/opgeslagen6.png" width="250">

Elke keer als een fragment met data wordt opgeslagen door de duiker, controleert de applicatie of alle data al is ingevuld. Zodra dit het geval is, wordt een definitieve save knop zichtbaar. Als de gebruiker deze aantikt, gaat de activity de stikstoflevels berekenen met behulp van de NitrogenCalculator class en de ingevoerde data. Er wordt gebruik gemaakt van drie dictionaries, die eerst als input stream worden ingelezen en vervolgens in nested HashMaps worden geplaatst. Deze bevatten onder andere de verhouding tussen diepte, tijd en stikstof, de verhouding tussen stikstof en oppervlaktetijd en de tijd die extra moet worden gerekend als de duiker al stikstof in zijn bloed had voor hij aan de duik begon. Als de berekening is gemaakt, krijgt de duiker een dialog te zien met zijn stikstoflevel voor de duik, na de duik en op het moment van loggen. Als de stikstoflevels hoog zijn, staat hier ook een waarschuwing vermeld. De duik wordt vervolgens via de de DiveManager class als DiveItem opgeslagen op Firebase. Ook wordt hier het LastDive item geüpdate op Firebase.

De dialog geeft ook de optie om een timer te zetten voor als alle stikstof uit het bloed is verdwenen. Als de gebruiker hiervoor kiest, wordt de duiker naar NitrogenActivity gebracht. Eerst wordt uitgerekend hoelang het duurt voor alle stikstof is verdwenen. Daarna wordt vanuit deze activity een timer gezet met behulp van de AlertReceiver class. Deze stuurt een notificatie als de duiker stikstof-vrij is. Als hij op deze notificatie klikt wordt hij teruggebracht naar de NitrogenActivity, waar zijn stikstoflevel dan in beeld staat.

<img src="https://github.com/JessieStam/jstam_programmeerproject/blob/master/doc/stikstofdialog.png" width="250">
<img src="https://github.com/JessieStam/jstam_programmeerproject/blob/master/doc/timeraan.png" width="250">
<img src="https://github.com/JessieStam/jstam_programmeerproject/blob/master/doc/notificatie.png" width="250">

De NitrogenActivity is ook te bereiken via de toolbar en de MenuActivity. Als de duiker op deze manier de activity opent, staat het laatst berekende stikstoflevel in beeld. Als er op de knop wordt gedrukt, wordt dit opnieuw uitgerekend en wordt de Firebase data geupdate.

<img src="https://github.com/JessieStam/jstam_programmeerproject/blob/master/doc/stikstofeerst.png" width="250">
<img src="https://github.com/JessieStam/jstam_programmeerproject/blob/master/doc/stikstofnu.png" width="250">

De DiveLogActivity geeft de duiker een weergave van alle gemaakte duiken in een Recyclerview. Deze worden opgehaald van Firebase. Als er op één van de duiken wordt geklikt, wordt de duiker naar de LogDetailsActivity gebracht. Deze activity is in basis gelijk aan de NewDiveActivity: ook hier wordt gebruik gemaakt van vijftien fragments in een tab layout. Het verschil is dat hier niet de “unfinished” maar de “finished” fragments als eerste worden getoond. Het is immers de bedoeling dat de duiker zijn duik hier terug kan zien. Wel kan de data hier nog veranderd worden, door op de bewerkknop te klikken. Hierdoor wordt het fragment verwisseld met het  “unfinished” fragment en kan de data worden aangepast. Wanneer de gebruiker nu op de opslaan knop drukt, wordt de data meteen via de LogDetailsActivity en de DiveManager geüpdate op Firebase. In de tab layout is in de LogDetailsActivity een zesde fragment toegevoegd. Hier ziet de duiker zijn stikstoflevels. Dit fragment kan niet worden aangepast.

<img src="https://github.com/JessieStam/jstam_programmeerproject/blob/master/doc/duiklog.png" width="250">
<img src="https://github.com/JessieStam/jstam_programmeerproject/blob/master/doc/opgeslagenstikstof.png" width="250">

Tot slot is er nog de StatisticsActivity. Deze werkt vrij eenvoudig; als de activity wordt geopend, word de gebruikersnaam, totale bodemtijd en het aantal duiken van Firebase gehaald. Dit wordt aan de gebruiker getoond. Deze activity is puur omdat het leuk is om een overzicht van de progressie als duiker te hebben en heeft verder geen functionaliteit.

<img src="https://github.com/JessieStam/jstam_programmeerproject/blob/master/doc/statistieken.png" width="250">

De grootste uitdaging tijdens het maken van de applicatie was het werkend krijgen van de verschillende fragments. Al snel tijdens het maken van de applicatie kwam ik erachter dat het niet gebruiksvriendelijk is om één pagina te wijden aan alle in te vullen informatie. Er moet namelijk erg veel ingevuld worden… Door met fragments te werken ben ik dit probleem uit de weg gegaan, maar het bleek erg lastig om data tussen de fragments en activities uit te wisselen. Daar heeft dan ook erg veel tijd ingezeten. Het schrijven van de tekstbestanden, de HashMaps en de NitrogenCalculator was ook ingewikkelder dan ik van tevoren had gedacht. Ik had gehoopt dat die data al dan niet via een API beschikbaar zou zijn, maar dat bleek tevergeefs. Hierdoor ben ik veel tijd verloren aan iets waar ik dacht snel mee klaar te zijn. Daarnaast was Firebase ook niet altijd gemakkelijk om mee te werken. Omdat het ophalen van data via een andere thread gaat dan de rest van de applicatie, duurde het vaak te lang voor de data binnen was, wat tot veel problemen heeft geleidt. Hierdoor heb ik uiteindelijk van Firebase Helper class moeten verwijderen; het bleek nodig om het aanroepen van data is de functies zelf te doen, zodat ik de data ook echt kon toewijzen als ik zeker wist dat de data van Firebase was opgehaald. Qua code niet zo netjes als ik het graag had gezien, maar het werkt op z’n minst. 

Mijn eerste idee voor deze applicatie was om ook een functie te maken die de gebruikers in staat stelt om vissen te zoeken en toe te voegen aan het logboek. Dit leek me een leuke extra functie als uitbreiding op het traditionele logboek. Door tijdgebrek heb ik dit idee echter in de eerste week al losgelaten. Dit was een goed idee: de API die ik hiervoor had gevonden was niet altijd even betrouwbaar en door dit weg te laten heb ik veel meer tijd kunnen besteden aan de kernfunctionaliteit van de applicatie. Dit werkt nu naar behoren en dat is uiteindelijk veel belangrijker dan zo’n soort extraatje.

Als ik meer tijd had gehad voor deze applicatie had het me wel leuk geleken om dit nog te implementeren, maar in eerste instantie zou ik de applicatie nog iets gebruiksvriendelijker hebben gemaakt. Ik had bijvoorbeeld graag nog een password recovery functie geschreven,  zodat gebruikers ook nog in het logboek kunnen als ze hun inloggegevens kwijt zijn.  Daarnaast had ik nog wel iets meer willen doen aan het design, maar al met al ben ik heel tevreden met hoe de applicatie uiteindelijk is geworden. Ik zou dan ook niets fundamenteel veranderen aan de applicatie, enkel dingen toevoegen.
